import { createFileRoute } from '@tanstack/react-router'
import ReactMarkdown from 'react-markdown'
import { motion } from 'framer-motion'
import { BookOpen, Clock, Star } from 'lucide-react'
import { api } from '@/lib/axios'
import { CourseCard } from '@/components/courseCard'

export const Route = createFileRoute('/marketplace_/$course_id')({
  loader: async ({ params }) => {
    const response = await api.post('api/courses/getCourse', {
      _id: params.course_id,
    })
    return response.data
  },
  component: RouteComponent,
})

function RouteComponent() {
  const { course } = Route.useLoaderData()

  const containerVariants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: {
        staggerChildren: 0.1,
      },
    },
  }

  const itemVariants = {
    hidden: { x: -20, opacity: 0 },
    visible: {
      x: 0,
      opacity: 1,
      transition: {
        type: 'spring',
        stiffness: 100,
      },
    },
  }

  return (
    <motion.div
      className="grid grid-cols-1 md:grid-cols-3 h-full bg-gradient-to-r from-gray-100 to-white dark:from-dark-secondary dark:to-gray-900"
      variants={containerVariants}
      initial="hidden"
      animate="visible"
    >
      {/* Left Side: Scrollable content */}
      <div className="col-span-1 md:col-span-2 overflow-y-auto p-8 md:p-12">
        <motion.header
          className="pb-4 border-b-2 border-gray-200 dark:border-gray-700"
          variants={itemVariants}
        >
          <h1 className="text-4xl md:text-5xl font-bold text-slate-800 dark:text-white font-poppins">
            {course.title}
          </h1>
        </motion.header>

        <motion.div
          className="flex items-center space-x-6 text-gray-600 dark:text-gray-400 mt-4"
          variants={itemVariants}
        >
          <div className="flex items-center space-x-2">
            <BookOpen className="w-5 h-5 text-blue-500" />
            <span>{course.category}</span>
          </div>
          <div className="flex items-center space-x-2">
            <Star className="w-5 h-5 text-yellow-500" />
            <span>{course.rating || '4.5'}</span>
          </div>
          <div className="flex items-center space-x-2">
            <Clock className="w-5 h-5 text-red-500" />
            <span>{course.duration || '6 hours'}</span>
          </div>
        </motion.div>

        <motion.div
          className="pt-8 prose prose-lg max-w-none text-slate-700 dark:text-gray-300 font-roboto"
          variants={itemVariants}
        >
          <ReactMarkdown>{course.description}</ReactMarkdown>
        </motion.div>
      </div>

      {/* Right Side: Sticky card */}
      <div className="col-span-1 flex flex-col items-center p-8">
        <motion.div
          className="sticky top-10 w-full"
          variants={itemVariants}
          whileHover={{ scale: 1.02 }}
          transition={{ type: 'spring', stiffness: 400, damping: 10 }}
        >
          <CourseCard
            className="border-2 rounded-lg shadow-lg overflow-hidden"
            key={course._id}
            course={course}
          />
        </motion.div>
      </div>
    </motion.div>
  )
}
